<%= form_for @reply, html: { multipart: true, class: 'new_reply' } do |r| %>

  <%= r.hidden_field :ticket_id %>
  <dl class="tabs mt" data-tab>
    <dd><h3>Reply</h3></dd>
    <dd class="right"><a href="#preview">Preview</a></dd>
    <dd class="active right"><a href="#edit">Edit</a></dd>    
  </dl>
  <div class="tabs-content panel">
    <div class="content active full" id="edit">      
      <div class="row">
        <% if current_user.agent? %>
          <div class="medium-2 large-1 columns">
            <%= r.label :to, class: 'inline' %>
          </div>
          <div class="medium-10 large-11 columns">
            <%= r.text_field :to, label: false %>
          </div>
        </div>
        <div class="row">
          <div class="medium-2 large-1 columns">
            <%= r.label :cc, class: 'inline' %>
          </div>
          <div class="medium-10 large-11 columns">
            <%= r.text_field :cc, label: false %>
          </div>
        </div>
        <div class="row">
          <div class="medium-2 large-1 columns">
            <%= r.label :bcc, class: 'inline' %>
          </div>
          <div class="medium-10 large-11 columns">
            <%= r.text_field :bcc, label: false %>
          </div>
        </div>
      <% end %>

      <%= r.text_area :content, label: false %>
      <p>Replies are parsed with <a target="_blank" href="http://daringfireball.net/projects/markdown/syntax">Markdown</a>.</p>

      <% markdown = Redcarpet::Markdown.new Redcarpet::Render::HTML %>
      <%= markdown.render(current_user.signature.to_s).html_safe %>

      <%= label_tag 'attachment[]', 'Attach file(s)' %>
      <%= file_field_tag 'attachment[]', multiple: true, label: false %>
    </div>
    <div class="content full" id="preview">
      <%= markdown.render(@reply.content.to_s).html_safe %>
      <%= markdown.render(current_user.signature.to_s).html_safe %>
    </div>
  </div>
  <p>
    <%= r.submit value: 'Send reply', class: 'button regular radius' %>
  </p>
<% end %>

